/*
Sistema de gesti√≥n de biblioteca con materiales, usuarios y operaciones de pr√©stamo.
Autor: Zela Flores Gabriel Frank - Ingenier√≠a de Software 6¬∞ semestre
Fecha de creaci√≥n: 01/09/2025
√öltima modificaci√≥n: 01/09/2025
*/

// Clase abstracta que representa cualquier material de la biblioteca ,libros, revistas, etc
abstract class Material(val titulo: String, val autor: String, val anioPublicacion: Int) {
    abstract fun mostrarDetalles()  // M√©todo que cada material debe implementar a su manera
}

class Libro(
    titulo: String, autor: String, anio: Int,
    val genero: String, val paginas: Int
) : Material(titulo, autor, anio) {
    override fun mostrarDetalles() {
        println("üìò Libro: $titulo, Autor: $autor, A√±o: $anioPublicacion, G√©nero: $genero, P√°ginas: $paginas")
    }
}

class Revista(
    titulo: String, autor: String, anio: Int,
    val issn: String, val volumen: Int, val numero: Int, val editorial: String
) : Material(titulo, autor, anio) {
    override fun mostrarDetalles() {
        println("üìï Revista: $titulo, Autor: $autor, A√±o: $anioPublicacion, ISSN: $issn, Volumen: $volumen, N√∫mero: $numero, Editorial: $editorial")
    }
}

// Para usuarios porque autom√°ticamente genera equals, hashCode y toString
data class Usuario(val nombre: String, val apellido: String, val edad: Int)

// Interfaz que define todas las operaciones que debe tener una biblioteca
interface IBiblioteca {
    fun registrarMaterial(material: Material)
    fun registrarUsuario(usuario: Usuario)
    fun prestar(usuario: Usuario, material: Material)
    fun devolver(usuario: Usuario, material: Material)
    fun mostrarMaterialesDisponibles()
    fun mostrarMaterialesReservados(usuario: Usuario)
}

// biblioteca con todas las operaciones
class Biblioteca : IBiblioteca {
    private val materialesDisponibles = mutableListOf<Material>()  // Lista de materiales disponibles
    private val prestamos = mutableMapOf<Usuario, MutableList<Material>>()  // Mapa de prEstamos por usuario

    override fun registrarMaterial(material: Material) {
        materialesDisponibles.add(material)
    }

    override fun registrarUsuario(usuario: Usuario) {
        prestamos[usuario] = mutableListOf()  // lista vac√≠a para los pr√©stamos del usuario
    }

    // lo quita de disponibles y lo agrega a los pr√©stamos del usuario
    override fun prestar(usuario: Usuario, material: Material) {
        if (materialesDisponibles.remove(material)) {
            prestamos[usuario]?.add(material)
            println("‚úÖ Material prestado: ${material.titulo}")
        } else println("‚ö†Ô∏è Material no disponible.")
    }

    override fun devolver(usuario: Usuario, material: Material) {
        if (prestamos[usuario]?.remove(material) == true) {
            materialesDisponibles.add(material)
            println("‚úÖ Material devuelto: ${material.titulo}")
        } else {
            println("‚ö†Ô∏è El usuario no ten√≠a este material en pr√©stamo.")
        }
    }

    override fun mostrarMaterialesDisponibles() {
        println("üìö Materiales disponibles:")
    override fun mostrarMaterialesReservados(usuario: Usuario) {
}

// Funci√≥n principal para probar el sistema de biblioteca
fun main() {
    val biblioteca = Biblioteca()

    // üìò Libros de autores arequipe√±os reales
        1931,
        "Novela social",
        180
    )

    val libro2 = Libro(
        "Historia",
        250
    )

    val revista1 = Revista(
        "Revista Arequipa Cultural",
        "Varios autores",
        2021,
        "2718-4567",
        15,
        3,
        "Editorial UNSA"
    )

    val usuario1 = Usuario("Ana", "G√≥mez", 25)

    biblioteca.registrarMaterial(revista1)
    biblioteca.registrarUsuario(usuario1)

    biblioteca.mostrarMaterialesDisponibles()
    biblioteca.prestar(usuario1, libro1)
    biblioteca.mostrarMaterialesReservados(usuario1)
    biblioteca.devolver(usuario1, libro1)
    biblioteca.mostrarMaterialesDisponibles()
}
    // üëâ Estas l√≠neas deben estar dentro del main
    biblioteca.registrarMaterial(libro1)
    biblioteca.registrarMaterial(libro2)
        "Historia de Arequipa",
        "Francisco Mostajo",
        1924,
    val libro1 = Libro(
        "El tungsteno",
        "C√©sar Vallejo",
        println("üìñ Materiales reservados por ${usuario.nombre}:")
        prestamos[usuario]?.forEach { it.mostrarDetalles() }
    }
        if (materialesDisponibles.isEmpty()) println("No hay materiales disponibles.")
        materialesDisponibles.forEach { it.mostrarDetalles() }
    }
